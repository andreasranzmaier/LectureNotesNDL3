{
  "name": "Python Dev (uv; home venv)",
  "build": { "dockerfile": "Dockerfile", "context": "." },

  "remoteUser": "vscode",
  "containerUser": "vscode",
  "overrideCommand": true,
  "hostRequirements": {
    "gpu": "optional"
  },
  "runArgs": [
    "--gpus=all"
  ],

  "postCreateCommand": "bash -lc 'sed -i \"s/\\r$//\" .devcontainer/setup.sh .devcontainer/fix_perms.sh && bash .devcontainer/setup.sh'",

  "postStartCommand": "bash -lc 'bash .devcontainer/fix_perms.sh && bash .devcontainer/setup.sh'",

  "customizations": {
    "vscode": {
      "extensions": [
        "2gua.rainbow-brackets",
        "abusaidm.html-snippets",
        "alefragnani.bookmarks",
        "alexcvzz.vscode-sqlite",
        "batisteo.vscode-django",
        "bierner.markdown-preview-github-styles",
        "bmewburn.vscode-intelephense-client",
        "cschlosser.doxdocgen",
        "cweijan.dbclient-jdbc",
        "cweijan.vscode-database-client2",
        "cweijan.vscode-mysql-client2",
        "cweijan.vscode-myssql-client2",
        "cweijan.vscode-office",
        "cweijan.vscode-postgresql-client2",
        "davidanson.vscode-markdownlint",
        "disroop.conan",
        "donjayamanne.python-environment-manager",
        "donjayamanne.python-extension-pack",
        "dvirtz.parquet-viewer",
        "eamodio.gitlens",
        "ecmel.vscode-html-css",
        "emilast.logfilehighlighter",
        "fabiospampinato.vscode-diff",
        "formulahendry.vscode-mysql",
        "george-alisson.html-preview-vscode",
        "github.codespaces",
        "github.copilot-chat",
        "github.vscode-github-actions",
        "golang.go",
        "gruntfuggly.activitusbar",
        "gurumukhi.selected-lines-count",
        "ibm.output-colorizer",
        "jakebathman.mysql-syntax",
        "james-yu.latex-workshop",
        "jeff-hykin.better-cpp-syntax",
        "josetr.cmake-language-support-vscode",
        "kevinrose.vsc-python-indent",
        "koalamer.workspace-in-status-bar",
        "llvm-vs-code-extensions.vscode-clangd",
        "lucien-martijn.parquet-visualizer",
        "lvdn.s3x-explorer",
        "manuth.markdown-converter",
        "matepek.vscode-catch2-test-adapter",
        "mechatroner.rainbow-csv",
        "mhutchie.git-graph",
        "minhthai.vscode-todo-parser",
        "mondersky.tabscolor",
        "ms-azuretools.vscode-containers",
        "ms-azuretools.vscode-docker",
        "ms-dotnettools.csharp",
        "ms-dotnettools.vscode-dotnet-runtime",
        "ms-kubernetes-tools.vscode-kubernetes-tools",
        "ms-mssql.data-workspace-vscode",
        "ms-mssql.mssql",
        "ms-mssql.sql-bindings-vscode",
        "ms-mssql.sql-database-projects-vscode",
        "ms-python.debugpy",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.vscode-python-envs",
        "ms-toolsai.datawrangler",
        "ms-toolsai.jupyter",
        "ms-toolsai.jupyter-keymap",
        "ms-toolsai.jupyter-renderers",
        "ms-toolsai.vscode-ai-remote",
        "ms-toolsai.vscode-jupyter-cell-tags",
        "ms-toolsai.vscode-jupyter-slideshow",
        "ms-vscode-remote.remote-containers",
        "ms-vscode-remote.remote-ssh",
        "ms-vscode-remote.remote-ssh-edit",
        "ms-vscode-remote.remote-wsl",
        "ms-vscode-remote.vscode-remote-extensionpack",
        "ms-vscode.cmake-tools",
        "ms-vscode.cpptools",
        "ms-vscode.cpptools-extension-pack",
        "ms-vscode.cpptools-themes",
        "ms-vscode.hexeditor",
        "ms-vscode.live-server",
        "ms-vscode.makefile-tools",
        "ms-vscode.powershell",
        "ms-vscode.remote-explorer",
        "ms-vscode.remote-server",
        "ms-vsliveshare.vsliveshare",
        "ms-vsliveshare.vsliveshare-audio",
        "ms-vsliveshare.vsliveshare-pack",
        "njpwerner.autodocstring",
        "openai.chatgpt",
        "pkief.material-icon-theme",
        "qwtel.sqlite-viewer",
        "rdebugger.r-debugger",
        "redhat.vscode-xml",
        "redhat.vscode-yaml",
        "reditorsupport.r",
        "reditorsupport.r-syntax",
        "seriousbenentertainment.minio",
        "sidthesloth.html5-boilerplate",
        "takumii.markdowntable",
        "tamasfe.even-better-toml",
        "tht13.html-preview-vscode",
        "tom-latham.markdown-pdf-plus",
        "tomoki1207.pdf",
        "tushortz.python-extended-snippets",
        "twxs.cmake",
        "usernamehw.errorlens",
        "vangware.dark-plus-material",
        "visualstudioexptteam.intellicode-api-usage-examples",
        "visualstudioexptteam.vscodeintellicode",
        "vscode-icons-team.vscode-icons",
        "vscodevim.vim",
        "wholroyd.jinja",
        "xabikos.javascriptsnippets",
        "xdebug.php-debug",
        "yzhang.markdown-all-in-one",
        "zxh404.vscode-proto3"
      ],
      "settings": {
        "python.defaultInterpreterPath": "/home/vscode/.venv/bin/python",
        "python.terminal.activateEnvironment": true,
        "python.analysis.extraPaths": ["${workspaceFolder}/src"],
        "jupyter.jupyterServerType": "local"
      }
    }
  },

  "containerEnv": {
    "PYTHONPATH": "${containerWorkspaceFolder}/src",
    "UV_PROJECT_ENVIRONMENT": "/home/vscode/.venv",
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "compute,utility",
    "CUDA_HOME": "/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_nvcc",
    "XLA_FLAGS": "--xla_gpu_cuda_data_dir=/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_nvcc",
    "PATH": "/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_nvcc/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
    "LD_LIBRARY_PATH": "/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cublas/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_runtime/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cudnn/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cufft/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/curand/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cusolver/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cusparse/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/nccl/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/nvjitlink/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_cupti/lib:/home/vscode/.venv/lib/python3.11/site-packages/nvidia/cuda_nvcc/lib64"
  },
  "remoteEnv": {
    "VIRTUAL_ENV": "/home/vscode/.venv",
    "PATH": "/home/vscode/.venv/bin:${containerEnv:PATH}"
  },

  "mounts": [
    "source=pip_cache,target=/home/vscode/.cache/pip,type=volume",
    "source=uv_cache,target=/home/vscode/.cache/uv,type=volume"
  ]
}
